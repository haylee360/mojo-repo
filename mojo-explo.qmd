---
title: "Team Mojo Jojo"
author: "IMS"
format: html
editor: visual
editor_options: 
  chunk_output_type: console
---

```{r}
library(here)
library(tidyverse)
library(janitor)
library(lubridate)
library(patchwork)
```
/courses/EDS214/group_project/2024/team-mojo-jojo

```{r}
#read in the data 
BQ1 <- read_csv("/courses/EDS214/group_project/2024/team-mojo-jojo/raw_data/QuebradaCuenca1-Bisley.csv")
BQ2 <- read_csv("/courses/EDS214/group_project/2024/team-mojo-jojo/raw_data/QuebradaCuenca2-Bisley.csv")
BQ3 <- read_csv("/courses/EDS214/group_project/2024/team-mojo-jojo/raw_data/QuebradaCuenca3-Bisley.csv")
PRM <- read_csv("/courses/EDS214/group_project/2024/team-mojo-jojo/raw_data/RioMameyesPuenteRoto.csv")
```


```{r}
BQ1 <- BQ1 |> 
  clean_names() |> 
  mutate(date=ymd(sample_date))

BQ2 <- BQ2 |> 
  clean_names() |> 
  mutate(date=ymd(sample_date))  

BQ3 <- BQ3 |> 
  clean_names() |> 
  mutate(date=ymd(sample_date))

PRM <- PRM |> 
  clean_names() |> 
  mutate(date=ymd(sample_date))
```

```{r}
stream_df <- do.call("rbind", list(BQ1, BQ2, BQ3, PRM))

recreat_df <- stream_df |> 
  mutate(year=year(sample_date)) |> 
  filter(year>=1988 & year<=1994) |> 
  select(sample_date, sample_id, no3_n, k)
```

```{r}

p1 <- ggplot(recreat_df, aes(x=sample_date, linetype=sample_id)) +
  geom_line(aes(y=k)) +
  scale_x_date(position = "top") +
  labs(y = "K mg/l",
       x = "Years") +
  geom_vline(xintercept = ymd("1989-09-17"), linetype = 2)

p2 <- ggplot(recreat_df, aes(x=sample_date, linetype=sample_id)) +
  geom_smooth(aes(y=no3_n), show.legend = FALSE) +
  theme(axis.text.x=element_blank()) +
  ylab(bquote("NO[3]-N Âµgl^-1")) +
  geom_vline(xintercept = ymd("1989-09-17"), linetype = 2)


p1 / (p2 & xlab(NULL))  & theme(plot.margin = margin(0, 0, 0, 0),
                                plot.background = element_rect(fill = "white"),
        panel.background = element_rect(fill = "white"), 
        panel.border = element_rect(color = "black", fill = NA))
        


  
#p1 + facet_grid(parameter ~ ., scales = "free_y")
```


```{r}

ggplot(recreat_df, aes(x = sample_date, y = value)) +
  geom_line() +
  labs(y = "") +
  scale_y_continuous(expand = c(0.1, 0.1)) +
  facet_grid(label ~ ., switch = "y", scales = "free_y") +
  theme_classic() +
  theme(strip.background = element_blank(),
        strip.placement  = "outside",
        panel.spacing    = unit(0, "lines"),
        panel.border = element_rect(color = "black", fill = NA))
```


